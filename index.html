<!-- FILE: dice_exact5_image.html -->
<!DOCTYPE html>
<html lang="ja">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>5ãƒã‚¹ãƒ»ã´ã£ãŸã‚Šã§ãƒªãƒ³ã‚´</title>
<style>
  :root{ --fg:#fff; --glass:rgba(255,255,255,.08) }
  html,body{height:100%;margin:0}
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;color:var(--fg);
    background:#000 url("space_background.png") center/cover fixed no-repeat;
    display:flex;flex-direction:column;align-items:center;gap:12px;padding:14px;
  }
  .wrap{ width:min(560px,96vw); display:flex; flex-direction:column; gap:10px }
  .stage{
    border:1px solid rgba(255,255,255,.15); border-radius:16px;
    background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.35));
    padding:14px 14px 10px;
  }
  .hud{display:flex;gap:8px;flex-wrap:wrap;justify-content:space-between;align-items:center}
  .tags{display:flex;gap:8px;flex-wrap:wrap}
  .tag{padding:.2em .7em;border:1px solid rgba(255,255,255,.25);border-radius:999px;font-size:12px;opacity:.9;background:rgba(0,0,0,.25)}
  .row{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:8px}
  .cell{
    aspect-ratio:1/1; border-radius:12px; border:1px solid rgba(255,255,255,.18);
    background:var(--glass); position:relative; overflow:hidden;
    display:flex; align-items:center; justify-content:center;
  }
  .label{position:absolute;left:6px;top:6px;font-size:12px;opacity:.75}
  .char{
    width:70%; max-width:120px; object-fit:contain; filter:drop-shadow(0 2px 8px rgba(0,0,0,.5));
    user-select:none; -webkit-user-drag:none;
  }
  .apple{font-size:clamp(28px,7vw,40px); animation:bounce 1.2s infinite}
  @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
  .buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  button{
    flex:1 1 auto; min-width:120px; padding:14px 16px; font-size:18px;
    border-radius:999px; border:1px solid rgba(255,255,255,.18);
    background:rgba(0,0,0,.35); color:#fff
  }
  button:active{transform:scale(.98)}
  .log{
    border:1px solid rgba(255,255,255,.15); border-radius:12px;
    background:rgba(0,0,0,.25); padding:10px; min-height:64px; max-height:38vh; overflow:auto;
    font-size:14px; line-height:1.5;
  }
  .ok{color:#9be08d} .ng{color:#ff9aa7}
</style>
<body>
<div class="wrap">
  <div class="stage">
    <div class="hud">
      <strong>5ãƒã‚¹ãƒ»ã´ã£ãŸã‚Šãƒ«ãƒ¼ãƒ«</strong>
      <div class="tags">
        <span id="posTag" class="tag">ä½ç½®: 0/5</span>
        <span id="willTag" class="tag">æ„å¿—: 3</span>
        <span id="dieTag" class="tag">ãƒ€ã‚¤ã‚¹: â€•</span>
      </div>
    </div>

    <div class="row" id="board"></div>

    <div class="tags" style="margin-top:10px">
      <span class="tag">é€šã‚Šéãã¯ç„¡åŠ¹</span>
      <span class="tag">ã´ã£ãŸã‚Š5ã§ğŸ</span>
      <span class="tag">æ„å¿—Â±1ã¯å„1P</span>
    </div>
  </div>

  <div class="buttons">
    <button id="rollBtn">ğŸ² ã‚µã‚¤ã‚³ãƒ­</button>
    <button id="plusBtn">â• æ„å¿— +1</button>
    <button id="minusBtn">â– æ„å¿— -1</button>
    <button id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <div id="log" class="log"></div>
</div>

<script>
(() => {
  // ã“ã“ã ã‘å¤‰æ›´ã™ã‚Œã°ç”»åƒå·®ã—æ›¿ãˆOK
  const CHAR_PATH = "public/assets/stage1/ako.png";   // ã‚­ãƒ£ãƒ©ç”»åƒ
  const USE_APPLE_EMOJI = true;                       // true=ğŸçµµæ–‡å­— / false=ç”»åƒã«ã—ãŸã„å ´åˆã¯ä¸‹2è¡Œã‚’ä½¿ã†
  const APPLE_IMG_PATH = "public/assets/stage1/apple.png"; // ä½¿ã†ãªã‚‰é…ç½®ã—ã¦æœ‰åŠ¹åŒ–
  // èƒŒæ™¯ã¯ body ã® CSS ã§ "space_background.png" ã‚’å‚ç…§ã—ã¦ã„ã¾ã™

  const N = 5;     // ãƒã‚¹æ•°
  let pos = 0;     // ç¾åœ¨ä½ç½®
  let last = 0;    // ç›´è¿‘ãƒ€ã‚¤ã‚¹
  let will = 3;    // æ„å¿—ãƒã‚¤ãƒ³ãƒˆ
  let got = false; // ç²å¾—æ¸ˆã¿

  const boardEl = document.getElementById('board');
  const logEl   = document.getElementById('log');
  const posTag  = document.getElementById('posTag');
  const willTag = document.getElementById('willTag');
  const dieTag  = document.getElementById('dieTag');

  function vibrate(ms){ if(navigator.vibrate) navigator.vibrate(ms); }

  function log(msg, cls){
    const line = document.createElement('div');
    if(cls) line.className = cls;
    line.textContent = msg;
    logEl.prepend(line);
  }

  function appleNode(){
    if(USE_APPLE_EMOJI){
      const span = document.createElement('span');
      span.className = 'apple';
      span.textContent = 'ğŸ';
      return span;
    }else{
      const img = document.createElement('img');
      img.src = APPLE_IMG_PATH;
      img.alt = 'apple';
      img.className = 'char apple';
      return img;
    }
  }

  function charNode(){
    const img = document.createElement('img');
    img.src = CHAR_PATH;
    img.alt = 'char';
    img.className = 'char';
    img.onerror = () => { img.remove(); const sp=document.createElement('span'); sp.textContent='ğŸŸ¢'; sp.style.fontSize='32px'; sp.className='char'; boardEl.appendChild(sp); };
    return img;
  }

  function render(){
    boardEl.innerHTML = '';
    for(let i=1;i<=N;i++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      const label = document.createElement('span');
      label.className = 'label'; label.textContent = i;
      cell.appendChild(label);

      if(i===pos){
        cell.appendChild(charNode());
      }else if(i===N){
        cell.appendChild(appleNode());
      }

      boardEl.appendChild(cell);
    }
    posTag.textContent  = `ä½ç½®: ${pos}/${N}`;
    willTag.textContent = `æ„å¿—: ${will}`;
    dieTag.textContent  = `ãƒ€ã‚¤ã‚¹: ${last||'â€•'}`;
  }

  function roll(){
    if(got){ log('ã‚‚ã†ğŸã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ãŸã€‚ãƒªã‚»ãƒƒãƒˆã—ã¦å†æŒ‘æˆ¦ã§ãã¾ã™ã€‚'); vibrate(30); return; }
    last = Math.floor(Math.random()*6)+1;
    const next = pos + last;
    if(next === N){
      pos = next; got = true;
      log(`ãƒ€ã‚¤ã‚¹${last}ã€‚ã´ã£ãŸã‚Š${N}ï¼ğŸã‚²ãƒƒãƒˆï¼`, 'ok'); vibrate(80);
    }else if(next < N){
      pos = next;
      log(`ãƒ€ã‚¤ã‚¹${last} â†’ ä½ç½®${pos}/${N}ã€‚ã‚ã¨${N-pos}ã€‚`);
      vibrate(20);
    }else{
      log(`ãƒ€ã‚¤ã‚¹${last}ã¯é€šã‚Šéãï¼ˆ${pos}â†’${next}ï¼‰ã€‚ç„¡åŠ¹ã€‚`, 'ng'); vibrate(10);
    }
    render();
  }

  function adjust(delta){
    if(got){ log('ã™ã§ã«ğŸã‚’ç²å¾—æ¸ˆã¿ã§ã™ã€‚'); return; }
    if(will<=0){ log('æ„å¿—ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“ã€‚', 'ng'); vibrate(10); return; }
    if(last===0){ log('ã¾ãšã¯ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã£ã¦ãã ã•ã„ã€‚', 'ng'); vibrate(10); return; }

    const adj = last + delta;
    if(adj<1 || adj>6){ log('èª¿æ•´ã¯1ã€œ6ã®ç¯„å›²ã®ã¿æœ‰åŠ¹ã§ã™ã€‚', 'ng'); vibrate(10); return; }

    const next = pos + adj;
    will -= 1;

    if(next === N){
      pos = next; got = true;
      log(`æ„å¿—ã§${delta>0?'+1':'-1'} â†’ ${adj}ã€‚ã´ã£ãŸã‚Š${N}ï¼ğŸ`, 'ok'); vibrate(80);
    }else if(next < N){
      pos = next;
      log(`æ„å¿—ã§${delta>0?'+1':'-1'} â†’ ${adj}ã€‚ä½ç½®${pos}/${N}ã€‚ã‚ã¨${N-pos}ã€‚`, 'ok'); vibrate(20);
    }else{
      log(`æ„å¿—ã§${delta>0?'+1':'-1'} â†’ ${adj}ã§ã‚‚é€šã‚Šéãï¼ˆ${pos}â†’${next}ï¼‰ã€‚ç„¡åŠ¹ã€‚`, 'ng'); vibrate(10);
    }
    render();
  }

  function reset(){
    pos=0; last=0; will=3; got=false;
    log('ãƒªã‚»ãƒƒãƒˆã€‚ã´ã£ãŸã‚Š5ã‚’ç›®æŒ‡ãã†ã€‚');
    render();
  }

  document.getElementById('rollBtn').addEventListener('click', roll);
  document.getElementById('plusBtn').addEventListener('click', ()=>adjust(+1));
  document.getElementById('minusBtn').addEventListener('click', ()=>adjust(-1));
  document.getElementById('resetBtn').addEventListener('click', reset);

  render();
  log('ğŸ² ã‚µã‚¤ã‚³ãƒ­ã§é€²ã¿ã€é€šã‚Šéãã¯ç„¡åŠ¹ã€‚ã´ã£ãŸã‚Š5ã§ğŸã€‚æ„å¿—Â±1ã¯1Pã€‚');
})();
</script>
</body>
</html>
