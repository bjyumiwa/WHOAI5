<!-- FILE: whoai_dice_exact5.html -->
<!DOCTYPE html>
<html lang="ja">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WhoAI Dice ¬∑ 5„Éû„Çπ„Å¥„Å£„Åü„Çä</title>
<style>
  :root{ --fg:#fff; --glass:rgba(255,255,255,.08) }
  html,body{height:100%;margin:0}
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;color:var(--fg);
    background:#000 url("space_background.png") center/cover fixed no-repeat;
    display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px;
  }
  .container{width:min(720px,96vw);display:flex;flex-direction:column;gap:12px}
  .lang{position:fixed;right:10px;top:10px;display:flex;gap:6px;z-index:10}
  .chip{padding:.35em .7em;border:1px solid rgba(255,255,255,.25);border-radius:999px;font-size:12px;background:rgba(0,0,0,.35);cursor:pointer;user-select:none}
  .active{border-color:#a7e3ff;color:#a7e3ff}
  .card{
    border:1px solid rgba(255,255,255,.15);border-radius:16px;
    background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.35));
    padding:18px;
  }
  .title{font-size:clamp(22px,5.5vw,30px);font-weight:700;margin:6px 0}
  .subtitle{opacity:.9}
  .buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  button{
    flex:1 1 auto;min-width:140px;padding:14px 16px;font-size:18px;
    border-radius:999px;border:1px solid rgba(255,255,255,.18);
    background:rgba(0,0,0,.35);color:#fff;cursor:pointer
  }
  button:active{transform:scale(.98)}
  .row{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:10px}
  .cell{
    aspect-ratio:1/1;border-radius:12px;border:1px solid rgba(255,255,255,.18);
    background:var(--glass);position:relative;overflow:hidden;
    display:flex;align-items:center;justify-content:center;
  }
  .label{position:absolute;left:6px;top:6px;font-size:12px;opacity:.75}
  .char{width:70%;max-width:120px;object-fit:contain;filter:drop-shadow(0 2px 8px rgba(0,0,0,.5));user-select:none;-webkit-user-drag:none}
  .apple{font-size:clamp(28px,7vw,40px);animation:bounce 1.2s infinite}
  @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
  .hud{display:flex;gap:8px;flex-wrap:wrap;justify-content:space-between;align-items:center}
  .tags{display:flex;gap:8px;flex-wrap:wrap}
  .tag{padding:.2em .7em;border:1px solid rgba(255,255,255,.25);border-radius:999px;font-size:12px;opacity:.9;background:rgba(0,0,0,.25)}
  .log{border:1px solid rgba(255,255,255,.15);border-radius:12px;background:rgba(0,0,0,.25);padding:10px;min-height:64px;max-height:38vh;overflow:auto;font-size:14px;line-height:1.5}
  .ok{color:#9be08d}.ng{color:#ff9aa7}
  .hidden{display:none}
  .lead{line-height:1.8;white-space:pre-wrap}
  .list{line-height:1.8;margin:8px 0 0 0;padding-left:1em}
</style>
<body>
<div class="lang" id="langBar"></div>

<div class="container">

  <!-- 1) Ë°®Á¥ô -->
  <section id="view-cover" class="card">
    <div class="title" data-i18n="cover_title"></div>
    <div class="subtitle" data-i18n="cover_sub"></div>
    <div class="buttons">
      <button id="btnStart" data-i18n="btn_start"></button>
      <button id="btnAbout" data-i18n="btn_about"></button>
    </div>
  </section>

  <!-- 2) „Ç≤„Éº„É† -->
  <section id="view-game" class="card hidden">
    <div class="hud">
      <strong data-i18n="game_title"></strong>
      <div class="tags">
        <span id="posTag" class="tag"></span>
        <span id="willTag" class="tag"></span>
        <span id="dieTag" class="tag"></span>
      </div>
    </div>

    <div class="row" id="board"></div>

    <div class="tags" style="margin-top:10px">
      <span class="tag" data-i18n="rule_exact"></span>
      <span class="tag" data-i18n="rule_over"></span>
      <span class="tag" data-i18n="rule_will"></span>
    </div>

    <div class="buttons">
      <button id="rollBtn" data-i18n="btn_roll"></button>
      <button id="plusBtn" data-i18n="btn_plus"></button>
      <button id="minusBtn" data-i18n="btn_minus"></button>
      <button id="resetBtn" data-i18n="btn_reset"></button>
      <button id="btnBackCover" data-i18n="btn_back_cover"></button>
      <button id="btnToAbout" data-i18n="btn_to_about"></button>
    </div>

    <div id="log" class="log"></div>
  </section>

  <!-- 3) Á†îÁ©∂Ë™¨Êòé -->
  <section id="view-about" class="card hidden">
    <div class="title" data-i18n="about_title"></div>
    <div class="lead" data-i18n="about_lead"></div>

    <div class="subtitle" style="margin-top:14px" data-i18n="about_simple"></div>
    <ul class="list">
      <li data-i18n="about_rule"></li>
      <li data-i18n="about_why_care"></li>
      <li data-i18n="about_happy"></li>
    </ul>

    <div class="subtitle" style="margin-top:14px" data-i18n="about_research_q"></div>
    <ul class="list">
      <li data-i18n="about_rq1"></li>
      <li data-i18n="about_rq2"></li>
    </ul>

    <div class="subtitle" style="margin-top:14px" data-i18n="about_logs"></div>
    <ul class="list">
      <li data-i18n="about_log1"></li>
      <li data-i18n="about_log2"></li>
    </ul>

    <div class="buttons" style="margin-top:12px">
      <button id="btnBackGame" data-i18n="btn_back_game"></button>
      <button id="btnBackCover2" data-i18n="btn_back_cover"></button>
    </div>
  </section>

</div>

<script>
(() => {
  // ===== Ë®≠ÂÆöÔºàÂøÖË¶Å„Å™„ÇâÂ∑Æ„ÅóÊõø„ÅàÔºâ=====
  const CHAR_PATH = "public/assets/stage1/ako.png"; // „Ç≠„É£„É©ÁîªÂÉè
  const N = 5;                                      // „Éû„ÇπÊï∞
  const LANGS = ["ja","en","zh-Hans","zh-Hant","ko"];

  // ===== Â§öË®ÄË™û =====
  const I18N = {
    "ja":{
      cover_title:"WhoAI DiceÔºà5„Éû„Çπ„Éª„Å¥„Å£„Åü„ÇäÔºâ",
      cover_sub:"„Çµ„Ç§„Ç≥„É≠„ÅßÈÄ≤„ÇÄ„ÄÇ„Å¥„Å£„Åü„Çä„ÅßÂ∞è„Åï„Å™„ÅîË§íÁæé„ÄÇÂÅ∂ÁÑ∂„Å®ÊÑèÊÄù„ÅÆ„ÅÇ„ÅÑ„Å†„ÇíÂë≥„Çè„ÅÜÁü≠„ÅÑÊóÖ„ÄÇ",
      btn_start:"„Çπ„Çø„Éº„Éà",
      btn_about:"Á†îÁ©∂„ÅÆË™¨Êòé",
      btn_back_cover:"Ë°®Á¥ô„Å∏",
      btn_to_about:"Á†îÁ©∂„ÅÆË™¨Êòé„Å∏",
      btn_back_game:"„Ç≤„Éº„É†„Å∏Êàª„Çã",

      game_title:"5„Éû„Çπ„Éª„Å¥„Å£„Åü„Çä„É´„Éº„É´",
      rule_exact:"„Å¥„Å£„Åü„Çä5„Åßüçé",
      rule_over:"ÈÄö„ÇäÈÅé„Åé„ÅØÁÑ°Âäπ",
      rule_will:"ÊÑèÂøó¬±1„ÅØÂêÑ1P",

      btn_roll:"üé≤ „Çµ„Ç§„Ç≥„É≠",
      btn_plus:"‚ûï ÊÑèÂøó +1",
      btn_minus:"‚ûñ ÊÑèÂøó -1",
      btn_reset:"üîÑ „É™„Çª„ÉÉ„Éà",

      about_title:"Á†îÁ©∂„ÅÆË™¨Êòé",
      about_lead:
        "„Åì„ÅÆË©¶‰Ωú„ÅØ„Äå„Å™„Åú‰∫∫„ÅØÊÑèÊÄù„ÇíÂá∫„Åó„Å¶‰ªãÂÖ•„Åó„Å¶„Åó„Åæ„ÅÜ„ÅÆ„Åã„Äç„ÇíË¶≥ÂØü„Åô„Çã„Åü„ÇÅ„ÅÆË∂ÖÁü≠Á∑®„Ç≤„Éº„É†„Åß„Åô„ÄÇ„Çµ„Ç§„Ç≥„É≠ÔºùÂÅ∂ÁÑ∂„ÄÅÊÑèÂøó„Éù„Ç§„É≥„ÉàÔºùËá™ÂàÜ„ÅÆ‰ªãÂÖ•„ÄÇ‰∏°ËÄÖ„ÅÆ‰∫§Â∑Æ„ÅßÊÑõÁùÄ„ÇÑÊâãÂøú„Åà„Åå„Å©„ÅÆ„Çà„ÅÜ„Å´Áîü„Åæ„Çå„Çã„Åã„ÇíË¶ã„Åæ„Åô„ÄÇ",
      about_simple:"„Ç∑„É≥„Éó„É´„Å™Ê†∏",
      about_rule:"1Êó•Ôºà1„Éó„É¨„Ç§Ôºâ„Å´„Å§„Åç„ÄÅ„Çµ„Ç§„Ç≥„É≠„ÇíÊåØ„Çã„Å®„Ç≠„É£„É©„ÅåÈÄ≤„ÇÄ„ÄÇ„Å¥„Å£„Åü„ÇäÊ≠¢„Åæ„Å£„Åü„Çâ„ÅîË§íÁæé„ÄÇ",
      about_why_care:"‰∏ñË©±„Çí„Åô„ÇãÁêÜÁî±„ÅØ„ÄåËá™ÂàÜ„ÅÆ‰∏ÄÊâã„ÅåÁ¢∫„Åã„Å´Âäπ„ÅÑ„Åü„Äç„Å®„ÅÑ„ÅÜÊâã„Åñ„Çè„Çä„ÇíÂæó„Çã„Åü„ÇÅ„ÄÇ",
      about_happy:"„ÅÜ„Çå„Åó„Åï„ÅØ„ÄÅÂÅ∂ÁÑ∂„ÅßÂ±ä„ÅèÊó•„Å®„ÄÅÊÑèÊÄù„ÅßÂ±ä„ÅèÊó•„ÅÆ‰∏°Êñπ„ÅåÂ∞è„Åï„Å™Áâ©Ë™û„Å´„Å™„Çã„Åì„Å®„ÄÇ",

      about_research_q:"„É™„Çµ„Éº„ÉÅ„ÇØ„Ç®„Çπ„ÉÅ„Éß„É≥",
      about_rq1:"ÊÑèÊÄù„ÅÆÊäïÂÖ•„ÅØ„Å©„Çì„Å™Áä∂Ê≥Å„ÅßËµ∑„Åç„ÇÑ„Åô„ÅÑ„ÅãÔºàÊÉú„Åó„Åï„ÉªÂÖ±ÊÑü„ÉªÊäïË≥áÊÑüË¶ö„Å™„Å©Ôºâ„ÄÇ",
      about_rq2:"ÊÑèÊÄù„Å´„Çà„Çã‰ªãÂÖ•Âæå„ÄÅÊÑõÁùÄ„ÉªÂÜçË®™ÊÑèÂõ≥„ÅØ„Å©„ÅÆ„Çà„ÅÜ„Å´Â§âÂåñ„Åô„Çã„Åã„ÄÇ",

      about_logs:"Ë®àÊ∏¨„ÅÆ‰æãÔºàÂåøÂêç„ÉªÁ´ØÊú´ÂÜÖ„Åæ„Åü„ÅØÈõÜË®àÈÄÅ‰ø°„Å™„Åó„ÅÆË®≠ÂÆö„ÇÇÂèØÔºâ",
      about_log1:"„ÉÄ„Ç§„ÇπÁµêÊûú„ÉªÊÑèÂøó¬±1„ÅÆ‰ΩøÁî®ÂõûÊï∞„ÉªÊàêÂäü/ÈÄöÈÅé„ÉªÊâÄË¶Å„Çø„ÉÉ„ÉóÊï∞„ÄÇ",
      about_log2:"ÊàêÂäüÁõ¥Âæå„ÅÆËá™Â∑±Â†±ÂëäÔºàÊ•Ω„Åó„ÅÑ/ÊÇî„Åó„ÅÑ/Áô∫Ë¶ã„Åå„ÅÇ„Å£„Åü „Å™„Å©Ôºâ‚Äª‰ªªÊÑè„ÄÇ"
    },
    "en":{
      cover_title:"WhoAI Dice (Exact-5)",
      cover_sub:"Roll to move. Land exactly to earn a tiny reward. A short trip between chance and will.",
      btn_start:"Start",
      btn_about:"Research Notes",
      btn_back_cover:"Cover",
      btn_to_about:"Research",
      btn_back_game:"Back to Game",

      game_title:"Exact-5 Rule",
      rule_exact:"Exact 5 ‚Üí üçé",
      rule_over:"Overshoot = invalid",
      rule_will:"+/‚àí1 uses 1 Will",

      btn_roll:"üé≤ Roll",
      btn_plus:"‚ûï Will +1",
      btn_minus:"‚ûñ Will -1",
      btn_reset:"üîÑ Reset",

      about_title:"Research Notes",
      about_lead:
        "This mini-game observes why players willingly intervene. Dice = chance, Will = deliberate intervention. We look at how the interplay yields attachment and a sense of agency.",
      about_simple:"Simple core",
      about_rule:"Per play: roll to move; land exactly to get a reward.",
      about_why_care:"Why care: to feel that one‚Äôs small action truly worked.",
      about_happy:"Joy: both lucky days and will-driven days form a tiny narrative.",

      about_research_q:"Research questions",
      about_rq1:"When is willful intervention triggered (near-miss, empathy, sunk-cost, etc.)?",
      about_rq2:"How does intervention shift attachment and revisit intent?",

      about_logs:"Possible logs (local-only or disabled)",
      about_log1:"Dice results, ¬±1 uses, success/overshoot, taps.",
      about_log2:"Optional self-report right after success (fun/frustration/discovery)."
    },
    "zh-Hans":{
      cover_title:"WhoAI È™∞Â≠êÔºàÊ≠£Â•ΩÂà∞5Ôºâ",
      cover_sub:"Êé∑È™∞ÂâçËøõ„ÄÇÊ≠£Â•ΩÂà∞ËææËé∑ÂæóÂ∞èÂ•ñÂä±„ÄÇ‰ΩìÈ™å‚ÄúÂÅ∂ÁÑ∂‰∏éÊÑèÂøó‚ÄùÁöÑÁü≠ÊóÖÁ®ã„ÄÇ",
      btn_start:"ÂºÄÂßã",
      btn_about:"Á†îÁ©∂ËØ¥Êòé",
      btn_back_cover:"Â∞ÅÈù¢",
      btn_to_about:"Á†îÁ©∂ËØ¥Êòé",
      btn_back_game:"ËøîÂõûÊ∏∏Êàè",

      game_title:"Ê≠£Â•ΩÂà∞5ËßÑÂàô",
      rule_exact:"Ê≠£Â•Ω5 ‚Üí üçé",
      rule_over:"Ë∂ÖÂá∫Êó†Êïà",
      rule_will:"ÊÑèÂøó¬±1Ê∂àËÄó1ÁÇπ",

      btn_roll:"üé≤ Êé∑È™∞",
      btn_plus:"‚ûï ÊÑèÂøó +1",
      btn_minus:"‚ûñ ÊÑèÂøó -1",
      btn_reset:"üîÑ ÈáçÁΩÆ",

      about_title:"Á†îÁ©∂ËØ¥Êòé",
      about_lead:"Êú¨ÂéüÂûãÁî®‰∫éËßÇÂØü‚Äú‰∏∫‰Ωï‰∫∫‰ºö‰∏ªÂä®‰ªãÂÖ•‚Äù„ÄÇÈ™∞Â≠ê=ÂÅ∂ÁÑ∂ÔºåÊÑèÂøóÁÇπ=‰∏ªÂä®„ÄÇ‰∏§ËÄÖ‰∫§ÁªáÂ¶Ç‰Ωï‰∫ßÁîü‚ÄúÁà±ÁùÄÊÑü‚ÄùÂíå‚Äú‰ΩúÁî®ÊÑü‚Äù„ÄÇ",
      about_simple:"Ê†∏ÂøÉ",
      about_rule:"ÊØèÂõûÂêàÔºöÊé∑È™∞ÂâçËøõÔºõÊ≠£Â•ΩÂÅú‰∏ãËé∑ÂæóÂ•ñÂä±„ÄÇ",
      about_why_care:"Âä®Êú∫ÔºöÊÉ≥Á°ÆËÆ§Ëá™Â∑±ÁöÑÂ∞èÂä®‰ΩúÁ°ÆÂÆûÊúâÊïà„ÄÇ",
      about_happy:"Âø´‰πêÔºöÂπ∏ËøêËé∑Âæó‰∏éÊÑèÂøóËé∑ÂæóÈÉΩËÉΩÂΩ¢ÊàêÂ∞èÂèô‰∫ã„ÄÇ",

      about_research_q:"Á†îÁ©∂ÈóÆÈ¢ò",
      about_rq1:"‰ΩïÊó∂Êõ¥ÂÆπÊòìËß¶Âèë‰∏ªÂä®‰ªãÂÖ•ÔºàÂ∑Æ‰∏ÄÁÇπ„ÄÅÂÖ±ÊÉÖ„ÄÅÊäïÂÖ•ÊÑüÁ≠âÔºâÔºü",
      about_rq2:"‰ªãÂÖ•ÂêéÔºå‚ÄúÁà±ÁùÄ/ÂÜçÊ¨°Ê∏∏Áé©ÊÑèÂõæ‚ÄùÂ¶Ç‰ΩïÂèòÂåñÔºü",

      about_logs:"ËÆ∞ÂΩïÁ§∫‰æãÔºàÂèØ‰ªÖÊú¨Âú∞ÊàñÂÖ≥Èó≠Ôºâ",
      about_log1:"È™∞Â≠êÁªìÊûú„ÄÅ¬±1‰ΩøÁî®Ê¨°Êï∞„ÄÅÊàêÂäü/Ë∂ÖÂá∫„ÄÅÁÇπÂáªÊ¨°Êï∞„ÄÇ",
      about_log2:"ÊàêÂäüÂêéÂèØÈÄâÁöÑËá™ÊàëÊä•ÂëäÔºàÊúâË∂£/ÊáäÊÅº/ÂèëÁé∞Á≠âÔºâ„ÄÇ"
    },
    "zh-Hant":{
      cover_title:"WhoAI È™∞Â≠êÔºàÂâõÂ•ΩÂà∞5Ôºâ",
      cover_sub:"Êì≤È™∞ÂâçÈÄ≤„ÄÇÂâõÂ•ΩÂÅú‰∏ãÁç≤ÂæóÂ∞èÁçéÂãµ„ÄÇÂú®„ÄåÂÅ∂ÁÑ∂ËàáÊÑèÂøó„Äç‰πãÈñìÁöÑÁü≠ÊóÖÁ®ã„ÄÇ",
      btn_start:"ÈñãÂßã",
      btn_about:"Á†îÁ©∂Ë™™Êòé",
      btn_back_cover:"Â∞ÅÈù¢",
      btn_to_about:"Á†îÁ©∂Ë™™Êòé",
      btn_back_game:"ÂõûÂà∞ÈÅäÊà≤",

      game_title:"ÂâõÂ•ΩÂà∞5Ë¶èÂâá",
      rule_exact:"ÂâõÂ•Ω5 ‚Üí üçé",
      rule_over:"Ë∂ÖÈÅé‰ΩúÂª¢",
      rule_will:"ÊÑèÂøó¬±1Ê∂àËÄó1Èªû",

      btn_roll:"üé≤ Êì≤È™∞",
      btn_plus:"‚ûï ÊÑèÂøó +1",
      btn_minus:"‚ûñ ÊÑèÂøó -1",
      btn_reset:"üîÑ ÈáçË®≠",

      about_title:"Á†îÁ©∂Ë™™Êòé",
      about_lead:"Ê≠§ÂéüÂûãËßÄÂØü„ÄåÁÇ∫‰Ωï‰∫∫ÊúÉ‰∏ªÂãï‰ªãÂÖ•„Äç„ÄÇÈ™∞Â≠ê=ÂÅ∂ÁÑ∂ÔºåÊÑèÂøó=‰∏ªÂãï„ÄÇÂÖ©ËÄÖ‰∫§ÁπîÂ¶Ç‰ΩïÁî¢Áîü‰æùÈôÑËàáËÉΩÂãïÊÑü„ÄÇ",
      about_simple:"Ê†∏ÂøÉ",
      about_rule:"ÊØèÂõûÂêàÔºöÊì≤È™∞ÂâçÈÄ≤ÔºõÂâõÂ•ΩÂÅú‰∏ãÂç≥Áç≤ÁçéÂãµ„ÄÇ",
      about_why_care:"ÂãïÊ©üÔºöÁ¢∫Ë™çËá™Â∑±ÁöÑÂ∞èÂãï‰ΩúÁ¢∫ÂØ¶ÊúâÊïà„ÄÇ",
      about_happy:"ÂñúÊÇÖÔºöÂπ∏ÈÅãÊàñÊÑèÂøóÈÅîÊàêÈÉΩËÉΩÂΩ¢ÊàêÂ∞èÊïÖ‰∫ã„ÄÇ",

      about_research_q:"Á†îÁ©∂ÂïèÈ°å",
      about_rq1:"‰ΩïÊôÇËºÉÂÆπÊòìËß∏Áôº‰∏ªÂãï‰ªãÂÖ•ÔºàÂ∑Æ‰∏ÄÈªû„ÄÅÂÖ±ÊÑü„ÄÅÊäïÂÖ•ÊÑüÁ≠âÔºâÔºü",
      about_rq2:"‰ªãÂÖ•ÂæåÔºå‰æùÈôÑËàáÂõûË®™ÊÑèÂúñÂ¶Ç‰ΩïÊîπËÆäÔºü",

      about_logs:"Á¥ÄÈåÑÁØÑ‰æãÔºàÂèØÂÉÖÊú¨Ê©üÊàñÈóúÈñâÔºâ",
      about_log1:"È™∞Â≠êÁµêÊûú„ÄÅ¬±1Ê¨°Êï∏„ÄÅÊàêÂäü/Ë∂ÖÈÅé„ÄÅÈªûÊìäÊï∏„ÄÇ",
      about_log2:"ÊàêÂäüÂæåÁöÑÂèØÈÅ∏Ëá™ÊàëÂõûÈ•ãÔºàÊúâË∂£/ÊáäÊÉ±/ÁôºÁèæÔºâ„ÄÇ"
    },
    "ko":{
      cover_title:"WhoAI Dice (Ï†ïÌôïÌûà 5)",
      cover_sub:"Ï£ºÏÇ¨ÏúÑÎ•º Íµ¥Î†§ Ï†ÑÏßÑ. Ï†ïÌôïÌûà ÎèÑÏ∞©ÌïòÎ©¥ ÏûëÏùÄ Î≥¥ÏÉÅ. Ïö∞Ïó∞Í≥º ÏùòÏßÄ ÏÇ¨Ïù¥Ïùò ÏßßÏùÄ Ïó¨Ìñâ.",
      btn_start:"ÏãúÏûë",
      btn_about:"Ïó∞Íµ¨ ÏÑ§Î™Ö",
      btn_back_cover:"ÌëúÏßÄ",
      btn_to_about:"Ïó∞Íµ¨",
      btn_back_game:"Í≤åÏûÑÏúºÎ°ú",

      game_title:"Ï†ïÌôïÌûà 5 Í∑úÏπô",
      rule_exact:"Ï†ïÌôïÌûà 5 ‚Üí üçé",
      rule_over:"Ï¥àÍ≥º Ïù¥ÎèôÏùÄ Î¨¥Ìö®",
      rule_will:"ÏùòÏßÄ ¬±1ÏùÄ 1Ìè¨Ïù∏Ìä∏",

      btn_roll:"üé≤ Íµ¥Î¶¨Í∏∞",
      btn_plus:"‚ûï ÏùòÏßÄ +1",
      btn_minus:"‚ûñ ÏùòÏßÄ -1",
      btn_reset:"üîÑ Î¶¨ÏÖã",

      about_title:"Ïó∞Íµ¨ ÏÑ§Î™Ö",
      about_lead:"Ïù¥ ÌîÑÎ°úÌÜ†ÌÉÄÏûÖÏùÄ Ïôú ÏÇ¨ÎûåÏù¥ ÏûêÎ∞úÏ†ÅÏúºÎ°ú Í∞úÏûÖÌïòÎäîÏßÄ Í¥ÄÏ∞∞Ìï©ÎãàÎã§. Ï£ºÏÇ¨ÏúÑ=Ïö∞Ïó∞, ÏùòÏßÄ=Í∞úÏûÖ. Îëê ÏöîÏÜåÍ∞Ä Ïï†Ï∞©Í≥º ÏûëÎèôÍ∞êÏùÑ Ïñ¥ÎñªÍ≤å ÎÇ≥ÎäîÏßÄ Î¥ÖÎãàÎã§.",
      about_simple:"ÌïµÏã¨",
      about_rule:"ÌîåÎ†àÏù¥ÎßàÎã§ Ï£ºÏÇ¨ÏúÑÎ•º Íµ¥Î†§ Ïù¥Îèô, Ï†ïÌôïÌûà ÎèÑÏ∞©ÌïòÎ©¥ Î≥¥ÏÉÅ.",
      about_why_care:"ÎèåÎ≥¥Îäî Ïù¥Ïú†: ÏûëÏùÄ ÌñâÎèôÏù¥ Ïã§Ï†úÎ°ú Ìö®Í≥º ÏûàÏóàÎã§Îäî Í∞êÍ∞Å.",
      about_happy:"Í∏∞ÏÅ®: Ïö¥ÏúºÎ°ú Îêú ÎÇ†Í≥º ÏùòÏßÄÎ°ú Îêú ÎÇ†Ïù¥ ÏûëÏùÄ Ïù¥ÏïºÍ∏∞Î°ú ÎÇ®Ïùå.",

      about_research_q:"Ïó∞Íµ¨ ÏßàÎ¨∏",
      about_rq1:"Í∞úÏûÖÏù¥ Ï¥âÎ∞úÎêòÎäî ÏàúÍ∞ÑÏùÄ Ïñ∏Ï†úÏù∏Í∞Ä(ÏïÑÍπùÎã§, Í≥µÍ∞ê, Ìà¨ÏûêÍ∞ê Îì±)?",
      about_rq2:"Í∞úÏûÖ ÌõÑ Ïï†Ï∞©/Ïû¨Î∞©Î¨∏ ÏùòÎèÑÎäî Ïñ¥ÎñªÍ≤å Î≥ÄÌïòÎäîÍ∞Ä?",

      about_logs:"Í∏∞Î°ù ÏòàÏãú(Î°úÏª¨ Ï†ÑÏö© ÎòêÎäî ÎπÑÌôúÏÑ±Ìôî Í∞ÄÎä•)",
      about_log1:"Ï£ºÏÇ¨ÏúÑ Í≤∞Í≥º, ¬±1 ÏÇ¨Ïö©, ÏÑ±Í≥µ/Ï¥àÍ≥º, ÌÉ≠ Ïàò.",
      about_log2:"ÏÑ±Í≥µ ÏßÅÌõÑ ÏÑ†ÌÉùÏ†Å ÏûêÍ∏∞Î≥¥Í≥†(Ïû¨ÎØ∏/ÏïÑÏâ¨ÏõÄ/Î∞úÍ≤¨)."
    }
  };

  // ===== „Éì„É•„ÉºÂàáÊõø =====
  const V = {
    cover: document.getElementById('view-cover'),
    game:  document.getElementById('view-game'),
    about: document.getElementById('view-about')
  };
  function show(name){
    V.cover.classList.toggle('hidden', name!=='cover');
    V.game .classList.toggle('hidden', name!=='game');
    V.about.classList.toggle('hidden', name!=='about');
    localStorage.setItem('whoai_view', name);
  }

  // ===== Ë®ÄË™ûUI =====
  const langBar = document.getElementById('langBar');
  let lang = localStorage.getItem('whoai_lang') || 'ja';
  if(!I18N[lang]) lang='ja';

  function renderLang(){
    langBar.innerHTML='';
    LANGS.forEach(code=>{
      const b=document.createElement('div');
      b.className='chip'+(code===lang?' active':'');
      b.textContent=code;
      b.onclick=()=>{ lang=code; localStorage.setItem('whoai_lang', lang); applyI18N(); renderLang(); render(); };
      langBar.appendChild(b);
    });
  }

  function applyI18N(){
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k=el.getAttribute('data-i18n');
      el.textContent = (I18N[lang] && I18N[lang][k]) ? I18N[lang][k] : k;
    });
  }

  // ===== „Ç≤„Éº„É†Êú¨‰Ωì =====
  let pos=0,last=0,will=3,got=false;
  const boardEl=document.getElementById('board');
  const logEl=document.getElementById('log');
  const posTag=document.getElementById('posTag');
  const willTag=document.getElementById('willTag');
  const dieTag=document.getElementById('dieTag');

  function vibrate(ms){ if(navigator.vibrate) navigator.vibrate(ms); }

  function log(msg, cls){
    const line=document.createElement('div');
    if(cls) line.className=cls;
    line.textContent=msg;
    logEl.prepend(line);
  }

  function appleNode(){
    const span=document.createElement('span');
    span.className='apple';
    span.textContent='üçé';
    return span;
  }
  function charNode(){
    const img=document.createElement('img');
    img.src=CHAR_PATH; img.alt='char'; img.className='char';
    img.onerror=()=>{img.remove(); const s=document.createElement('span'); s.textContent='üü¢'; s.style.fontSize='32px'; s.className='char'; boardEl.appendChild(s);};
    return img;
  }

  function render(){
    // HUD
    posTag.textContent = (I18N[lang]?.posTag || 'Pos') + `: ${pos}/${N}`;
    willTag.textContent = (I18N[lang]?.willTag || 'Will') + `: ${will}`;
    dieTag.textContent = (I18N[lang]?.dieTag || 'Dice') + `: ${last||'‚Äï'}`;

    // Áõ§
    boardEl.innerHTML='';
    for(let i=1;i<=N;i++){
      const cell=document.createElement('div');
      cell.className='cell';
      const label=document.createElement('span');
      label.className='label'; label.textContent=i;
      cell.appendChild(label);

      if(i===pos) cell.appendChild(charNode());
      else if(i===N) cell.appendChild(appleNode());

      boardEl.appendChild(cell);
    }
  }

  function roll(){
    if(got){ log(msg('already'), null); vibrate(30); return; }
    last = Math.floor(Math.random()*6)+1;
    const next = pos + last;
    if(next === N){
      pos = next; got = true;
      log(msg('exact', {n:last}), 'ok'); vibrate(80);
    }else if(next < N){
      pos = next;
      log(msg('forward', {n:last, remain:N-pos}), null); vibrate(20);
    }else{
      log(msg('over', {n:last, to:next}), 'ng'); vibrate(10);
    }
    render();
  }

  function adjust(delta){
    if(got){ log(msg('already'), null); return; }
    if(will<=0){ log(msg('no_will'), 'ng'); vibrate(10); return; }
    if(last===0){ log(msg('need_roll'), 'ng'); vibrate(10); return; }

    const adj = last + delta;
    if(adj<1 || adj>6){ log(msg('range'), 'ng'); vibrate(10); return; }

    const next = pos + adj; will -= 1;
    if(next === N){
      pos=next; got=true;
      log(msg('adjust_exact', {d:delta>0?'+1':'-1', adj}), 'ok'); vibrate(80);
    }else if(next < N){
      pos=next; log(msg('adjust_forward', {d:delta>0?'+1':'-1', adj, remain:N-pos}), 'ok'); vibrate(20);
    }else{
      log(msg('adjust_over', {d:delta>0?'+1':'-1', adj, to:next}), 'ng'); vibrate(10);
    }
    render();
  }

  function reset(){
    pos=0; last=0; will=3; got=false;
    log(msg('reset')); render();
  }

  // „É≠„Ç∞ÊñáË®ÄÔºàÂêÑË®ÄË™ûÔºâ
  function msg(key, p={}){
    const T={
      ja:{
        already:"„ÇÇ„ÅÜüçé„ÇíÊâã„Å´ÂÖ•„Çå„Åæ„Åó„Åü„ÄÇ„É™„Çª„ÉÉ„Éà„Åó„Å¶ÂÜçÊåëÊà¶„Åß„Åç„Åæ„Åô„ÄÇ",
        exact:(o)=>`„ÉÄ„Ç§„Çπ${o.n}„ÄÇ„Å¥„Å£„Åü„Çä${N}ÔºÅüçé„Ç≤„ÉÉ„ÉàÔºÅ`,
        forward:(o)=>`„ÉÄ„Ç§„Çπ${o.n} ‚Üí ‰ΩçÁΩÆ${pos}/${N}„ÄÇ„ÅÇ„Å®${o.remain}„ÄÇ`,
        over:(o)=>`„ÉÄ„Ç§„Çπ${o.n}„ÅØÈÄö„ÇäÈÅé„ÅéÔºà${pos}‚Üí${o.to}Ôºâ„ÄÇÁÑ°Âäπ„ÄÇ`,
        no_will:"ÊÑèÂøó„Éù„Ç§„É≥„Éà„ÅåË∂≥„Çä„Åæ„Åõ„Çì„ÄÇ",
        need_roll:"„Åæ„Åö„ÅØ„Çµ„Ç§„Ç≥„É≠„ÇíÊåØ„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        range:"Ë™øÊï¥„ÅØ1„Äú6„ÅÆÁØÑÂõ≤„ÅÆ„ÅøÊúâÂäπ„Åß„Åô„ÄÇ",
        adjust_exact:(o)=>`ÊÑèÂøó„Åß${o.d} ‚Üí ${o.adj}„ÄÇ„Å¥„Å£„Åü„Çä${N}ÔºÅüçé`,
        adjust_forward:(o)=>`ÊÑèÂøó„Åß${o.d} ‚Üí ${o.adj}„ÄÇ‰ΩçÁΩÆ${pos}/${N}„ÄÇ„ÅÇ„Å®${o.remain}„ÄÇ`,
        adjust_over:(o)=>`ÊÑèÂøó„Åß${o.d} ‚Üí ${o.adj}„Åß„ÇÇÈÄö„ÇäÈÅé„ÅéÔºà${pos}‚Üí${o.to}Ôºâ„ÄÇÁÑ°Âäπ„ÄÇ`,
        reset:"„É™„Çª„ÉÉ„Éà„ÄÇ„Å¥„Å£„Åü„Çä5„ÇíÁõÆÊåá„Åù„ÅÜ„ÄÇ"
      },
      en:{
        already:"üçé already obtained. Reset to try again.",
        exact:(o)=>`Dice ${o.n}. Exact ${N}! üçé`,
        forward:(o)=>`Dice ${o.n} ‚Üí pos ${pos}/${N}. remain ${o.remain}.`,
        over:(o)=>`Dice ${o.n} overshoot (${pos}‚Üí${o.to}). invalid.`,
        no_will:"No Will points.",
        need_roll:"Roll the dice first.",
        range:"Adjust only within 1‚Äì6.",
        adjust_exact:(o)=>`Will ${o.d} ‚Üí ${o.adj}. Exact ${N}! üçé`,
        adjust_forward:(o)=>`Will ${o.d} ‚Üí ${o.adj}. pos ${pos}/${N}. remain ${o.remain}.`,
        adjust_over:(o)=>`Will ${o.d} ‚Üí ${o.adj} overshoot (${pos}‚Üí${o.to}). invalid.`,
        reset:"Reset. Aim for exact 5."
      }
    };
    const pack = T[lang] || T.ja;
    const val = pack[key];
    return typeof val==="function" ? val(p) : val || key;
  }

  // ===== „Ç§„Éô„É≥„Éà =====
  document.getElementById('rollBtn').onclick = roll;
  document.getElementById('plusBtn').onclick = ()=>adjust(+1);
  document.getElementById('minusBtn').onclick = ()=>adjust(-1);
  document.getElementById('resetBtn').onclick = reset;

  document.getElementById('btnStart').onclick = ()=>show('game');
  document.getElementById('btnAbout').onclick = ()=>show('about');
  document.getElementById('btnBackCover').onclick = ()=>show('cover');
  document.getElementById('btnBackCover2').onclick = ()=>show('cover');
  document.getElementById('btnBackGame').onclick = ()=>show('game');
  document.getElementById('btnToAbout').onclick = ()=>show('about');

  // ===== ÂàùÊúüÂåñ =====
  renderLang();
  applyI18N();
  render();
  show(localStorage.getItem('whoai_view') || 'cover');
})();
</script>
</body>
</html>
