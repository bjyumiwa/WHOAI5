<!-- FILE: dice_exact5_image.html -->
<!DOCTYPE html>
<html lang="ja">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>5マス・ぴったりでリンゴ</title>
<style>
  :root{ --fg:#fff; --glass:rgba(255,255,255,.08) }
  html,body{height:100%;margin:0}
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;color:var(--fg);
    background:#000 url("space_background.png") center/cover fixed no-repeat;
    display:flex;flex-direction:column;align-items:center;gap:12px;padding:14px;
  }
  .wrap{ width:min(560px,96vw); display:flex; flex-direction:column; gap:10px }
  .stage{
    border:1px solid rgba(255,255,255,.15); border-radius:16px;
    background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.35));
    padding:14px 14px 10px;
  }
  .hud{display:flex;gap:8px;flex-wrap:wrap;justify-content:space-between;align-items:center}
  .tags{display:flex;gap:8px;flex-wrap:wrap}
  .tag{padding:.2em .7em;border:1px solid rgba(255,255,255,.25);border-radius:999px;font-size:12px;opacity:.9;background:rgba(0,0,0,.25)}
  .row{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:8px}
  .cell{
    aspect-ratio:1/1; border-radius:12px; border:1px solid rgba(255,255,255,.18);
    background:var(--glass); position:relative; overflow:hidden;
    display:flex; align-items:center; justify-content:center;
  }
  .label{position:absolute;left:6px;top:6px;font-size:12px;opacity:.75}
  .char{
    width:70%; max-width:120px; object-fit:contain; filter:drop-shadow(0 2px 8px rgba(0,0,0,.5));
    user-select:none; -webkit-user-drag:none;
  }
  .apple{font-size:clamp(28px,7vw,40px); animation:bounce 1.2s infinite}
  @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
  .buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  button{
    flex:1 1 auto; min-width:120px; padding:14px 16px; font-size:18px;
    border-radius:999px; border:1px solid rgba(255,255,255,.18);
    background:rgba(0,0,0,.35); color:#fff
  }
  button:active{transform:scale(.98)}
  .log{
    border:1px solid rgba(255,255,255,.15); border-radius:12px;
    background:rgba(0,0,0,.25); padding:10px; min-height:64px; max-height:38vh; overflow:auto;
    font-size:14px; line-height:1.5;
  }
  .ok{color:#9be08d} .ng{color:#ff9aa7}
</style>
<body>
<div class="wrap">
  <div class="stage">
    <div class="hud">
      <strong>5マス・ぴったりルール</strong>
      <div class="tags">
        <span id="posTag" class="tag">位置: 0/5</span>
        <span id="willTag" class="tag">意志: 3</span>
        <span id="dieTag" class="tag">ダイス: ―</span>
      </div>
    </div>

    <div class="row" id="board"></div>

    <div class="tags" style="margin-top:10px">
      <span class="tag">通り過ぎは無効</span>
      <span class="tag">ぴったり5で🍎</span>
      <span class="tag">意志±1は各1P</span>
    </div>
  </div>

  <div class="buttons">
    <button id="rollBtn">🎲 サイコロ</button>
    <button id="plusBtn">➕ 意志 +1</button>
    <button id="minusBtn">➖ 意志 -1</button>
    <button id="resetBtn">🔄 リセット</button>
  </div>

  <div id="log" class="log"></div>
</div>

<script>
(() => {
  // ここだけ変更すれば画像差し替えOK
  const CHAR_PATH = "public/assets/stage1/ako.png";   // キャラ画像
  const USE_APPLE_EMOJI = true;                       // true=🍎絵文字 / false=画像にしたい場合は下2行を使う
  const APPLE_IMG_PATH = "public/assets/stage1/apple.png"; // 使うなら配置して有効化
  // 背景は body の CSS で "space_background.png" を参照しています

  const N = 5;     // マス数
  let pos = 0;     // 現在位置
  let last = 0;    // 直近ダイス
  let will = 3;    // 意志ポイント
  let got = false; // 獲得済み

  const boardEl = document.getElementById('board');
  const logEl   = document.getElementById('log');
  const posTag  = document.getElementById('posTag');
  const willTag = document.getElementById('willTag');
  const dieTag  = document.getElementById('dieTag');

  function vibrate(ms){ if(navigator.vibrate) navigator.vibrate(ms); }

  function log(msg, cls){
    const line = document.createElement('div');
    if(cls) line.className = cls;
    line.textContent = msg;
    logEl.prepend(line);
  }

  function appleNode(){
    if(USE_APPLE_EMOJI){
      const span = document.createElement('span');
      span.className = 'apple';
      span.textContent = '🍎';
      return span;
    }else{
      const img = document.createElement('img');
      img.src = APPLE_IMG_PATH;
      img.alt = 'apple';
      img.className = 'char apple';
      return img;
    }
  }

  function charNode(){
    const img = document.createElement('img');
    img.src = CHAR_PATH;
    img.alt = 'char';
    img.className = 'char';
    img.onerror = () => { img.remove(); const sp=document.createElement('span'); sp.textContent='🟢'; sp.style.fontSize='32px'; sp.className='char'; boardEl.appendChild(sp); };
    return img;
  }

  function render(){
    boardEl.innerHTML = '';
    for(let i=1;i<=N;i++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      const label = document.createElement('span');
      label.className = 'label'; label.textContent = i;
      cell.appendChild(label);

      if(i===pos){
        cell.appendChild(charNode());
      }else if(i===N){
        cell.appendChild(appleNode());
      }

      boardEl.appendChild(cell);
    }
    posTag.textContent  = `位置: ${pos}/${N}`;
    willTag.textContent = `意志: ${will}`;
    dieTag.textContent  = `ダイス: ${last||'―'}`;
  }

  function roll(){
    if(got){ log('もう🍎を手に入れました。リセットして再挑戦できます。'); vibrate(30); return; }
    last = Math.floor(Math.random()*6)+1;
    const next = pos + last;
    if(next === N){
      pos = next; got = true;
      log(`ダイス${last}。ぴったり${N}！🍎ゲット！`, 'ok'); vibrate(80);
    }else if(next < N){
      pos = next;
      log(`ダイス${last} → 位置${pos}/${N}。あと${N-pos}。`);
      vibrate(20);
    }else{
      log(`ダイス${last}は通り過ぎ（${pos}→${next}）。無効。`, 'ng'); vibrate(10);
    }
    render();
  }

  function adjust(delta){
    if(got){ log('すでに🍎を獲得済みです。'); return; }
    if(will<=0){ log('意志ポイントが足りません。', 'ng'); vibrate(10); return; }
    if(last===0){ log('まずはサイコロを振ってください。', 'ng'); vibrate(10); return; }

    const adj = last + delta;
    if(adj<1 || adj>6){ log('調整は1〜6の範囲のみ有効です。', 'ng'); vibrate(10); return; }

    const next = pos + adj;
    will -= 1;

    if(next === N){
      pos = next; got = true;
      log(`意志で${delta>0?'+1':'-1'} → ${adj}。ぴったり${N}！🍎`, 'ok'); vibrate(80);
    }else if(next < N){
      pos = next;
      log(`意志で${delta>0?'+1':'-1'} → ${adj}。位置${pos}/${N}。あと${N-pos}。`, 'ok'); vibrate(20);
    }else{
      log(`意志で${delta>0?'+1':'-1'} → ${adj}でも通り過ぎ（${pos}→${next}）。無効。`, 'ng'); vibrate(10);
    }
    render();
  }

  function reset(){
    pos=0; last=0; will=3; got=false;
    log('リセット。ぴったり5を目指そう。');
    render();
  }

  document.getElementById('rollBtn').addEventListener('click', roll);
  document.getElementById('plusBtn').addEventListener('click', ()=>adjust(+1));
  document.getElementById('minusBtn').addEventListener('click', ()=>adjust(-1));
  document.getElementById('resetBtn').addEventListener('click', reset);

  render();
  log('🎲 サイコロで進み、通り過ぎは無効。ぴったり5で🍎。意志±1は1P。');
})();
</script>
</body>
</html>
