<!-- index.html · WhoAI Evo（名前入力＋ゲーム） -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WhoAI Evo · Game</title>
<style>
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;color:#fff;
    background:#000 url("public/assets/stage1/space_background.png") center/cover fixed no-repeat;
    margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;gap:16px;
  }
  .card{border:1px solid rgba(255,255,255,.18);border-radius:16px;background:rgba(0,0,0,.36);padding:20px;text-align:center;max-width:820px;width:100%}
  .hidden{display:none}
  .row{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:6px}
  .cell{aspect-ratio:1/1;border:1px solid rgba(255,255,255,.2);border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.08);position:relative}
  .label{position:absolute;left:6px;top:6px;font-size:12px;opacity:.75}
  .char{width:72%;max-width:120px;object-fit:contain}
  .goal{width:62%;max-width:100px;object-fit:contain;animation:bounce 1.2s infinite}
  @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
  .log{border:1px solid rgba(255,255,255,.18);border-radius:12px;background:rgba(0,0,0,.25);padding:10px;min-height:64px;max-height:38vh;overflow:auto;font-size:14px;text-align:left}
  .buttons{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
  button{flex:1 1 auto;min-width:120px;padding:12px 14px;font-size:16px;border-radius:999px;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.35);color:#fff;cursor:pointer}
  button:active{transform:scale(.97)}
  input{padding:10px;font-size:16px;border-radius:8px;border:1px solid rgba(255,255,255,.3);width:80%;max-width:300px}
</style>
</head>
<body>
<div class="card" id="view-name">
  <h2>キャラクターに名前をつけよう</h2>
  <input id="nameInput" type="text" placeholder="キャラの名前">
  <div class="buttons">
    <button id="btnSetName">OK</button>
  </div>
</div>

<div class="card hidden" id="view-game">
  <h1>WhoAI Evo 🎲</h1>
  <p id="greet"></p>
  <div id="board" class="row"></div>
  <div class="buttons">
    <button id="rollBtn">🎲 サイコロ</button>
    <button id="resetBtn">🔄 リセット</button>
    <a href="about.html"><button>📖 研究の説明</button></a>
  </div>
  <div id="log" class="log"></div>
</div>

<script>
let charName = localStorage.getItem("whoai_name") || "";
const nameView = document.getElementById("view-name");
const gameView = document.getElementById("view-game");
const greet = document.getElementById("greet");
const board=document.getElementById('board');
const logEl=document.getElementById('log');

let pos=1,last=0;

function show(view){
  nameView.classList.toggle("hidden", view!=="name");
  gameView.classList.toggle("hidden", view!=="game");
}

function renderBoard(){
  board.innerHTML='';
  for(let i=1;i<=5;i++){
    const cell=document.createElement('div');cell.className='cell';
    const l=document.createElement('span');l.className='label';l.textContent=i;cell.appendChild(l);
    if(i===pos){
      const img=document.createElement('img');img.src="public/assets/stage1/miwacchi_open.png";img.className='char';cell.appendChild(img);
    }
    if(i===5){
      const g=document.createElement('img');g.src="public/assets/stage1/macaron_pink.png";g.className='goal';cell.appendChild(g);
    }
    board.appendChild(cell);
  }
}

function log(msg,cls){
  const d=document.createElement("div");
  if(cls)d.className=cls;
  d.textContent=(charName? charName+"：":"")+msg;
  logEl.prepend(d);
}

function roll(){
  last=Math.floor(Math.random()*6)+1;
  const next=pos+last;
  if(next===5){pos=next;log("🎉 ぴったりマカロン！","ok");}
  else if(next<5){pos=next;log("位置 "+pos);}
  else{log("通り過ぎ","ng");}
  renderBoard();
}

function reset(){pos=1;logEl.innerHTML="";renderBoard();}

// 名前入力OK
document.getElementById("btnSetName").onclick=()=>{
  const val=document.getElementById("nameInput").value.trim();
  if(val){
    charName=val;
    localStorage.setItem("whoai_name", charName);
    greet.textContent = `${charName} の冒険が始まるよ！`;
    show("game");
    renderBoard();
  }
};

// ボタン操作
document.getElementById("rollBtn").onclick=roll;
document.getElementById("resetBtn").onclick=reset;

// 初期表示
if(charName){
  greet.textContent = `${charName} の冒険が始まるよ！`;
  show("game"); renderBoard();
}else{
  show("name");
}
</script>
</body>
</html>
